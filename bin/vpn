#!/bin/bash

gatewayIP=$(/bin/ip route show default | /bin/cut -d " " -f 3)
gatewayDevice=$(/bin/ip route show default | /bin/cut -d " " -f 5)
verifyGatewayIP=$(/bin/echo $gateway | /bin/tr -dc "." | /bin/wc -c)

if [[ $verifyGateway -ne 3 ]]; then
	/bin/echo Error default route is not ip $verifyIP
	exit
elif [[ $gatewayDevice != "wlo1" ]]; then
	/bin/echo Error default route is not ip $verifyIP
	exit
fi

case $1 in
	wg0)
	case $2 in
		up)
		host=$(sudo /bin/grep Endpoint /etc/wireguard/wg0.conf | /bin/cut -d"=" -f 2 | /bin/cut -d":" -f 1)
		hostIP=$(/bin/dig $host +short)
		verifyHostIP=$(/bin/echo $ip | /bin/tr -dc "." | /bin/wc -c)

		if [[ $verifyHostIP -ne 3 ]]; then
			/bin/echo Error no ip resolving
			exit
		fi

		#sudo wg-quick up wg0
		echo "/bin/ip route del default via $gatewayIP dev $gatewayDevice"
		echo "/bin/ip route add default dev wg0"
		echo "/bin/ip route add $hostIP via $gatewayIP dev $gatewayDevice"
		;;
	esac
	;;
esac
